Airfoil Generation Overview
---------------------------

QBlade calculates both local blade values as well as global performance metrics by using local aerodynamic properties of the discrete blade sections (see :doc:`../blade/blade`).
Prior to designing a blade, these must be defined for each blade section. For this purpose, QBlade has an airfoil module which allows creating or importing airfoil profiles. 
This module is shown in the main toolbar in :numref:`fig-airfoil-module`.

.. _fig-airfoil-module:
.. figure:: airfoil_module.png
    :align: center
    :alt: Airfoil design module in QBlade.

    The airfoil design module is represented by the foil symbol in the QBlade main tool bar.
	
Airfoils may be added to the active airfoil design list either by generating them within QBlade or importing them as described in the sections below. 
Airfoils objects can be removed or renamed simply by selecting the *Airfoil* dialog in the menu.
or by right-clicking on the appropriate item in the foil list (see :numref:`fig-naca-airfoil`). 
All airfoil profiles can be exported in a ``.txt`` file format. Once the airfoil profiles have been specified, the user can proceed with the aerodynamic analysis of the profiles (see :doc:`../airfoil/airfoil_analysis`).

Creating Standard Airfoils
--------------------------
Two standard airfoil types can be generated within QBlade automatically. Circular profiles can be generated by selecting *Circular Airfoil Generator* within the *Airfoil* menu option.
This type of airfoil is particularly useful for the generation of the root section of a turbine blade. 
As this generates only a drag force, the user is required to enter a numerical value for the Reynolds number and the corresponding drag coefficient.
In addition, the entire range of 4-digit NACA profiles :footcite:`Anderson_Book` can be automatically generated in QBlade by selecting the menu option *NACA Airfoil Generator*.
The user must then enter the 4-digit code of the desired airfoil profile and the number of panels used to discretize the surface. The result of generating a NACA 4412 profile with 100 panels is shown in :numref:`fig-naca-airfoil`.

.. _fig-naca-airfoil:
.. figure:: naca.png
    :align: center
    :alt: NACA Airfoil.

    A NACA 4412 airfoil generated within the airfoil design module. Airfoil coordinates are displayed in the visualisation window and can be selected in the foil list (bottom).
	
Importing Airfoils
--------------------------
The user also has the option to import arbitrary airfoil profiles in the format of a ``.dat`` file. This file must contain the [:math:`x`, :math:`y`] coordinates of the airfoil in two columns. 
The scaling and orientation of the imported airfoil is described in the following section.

Airfoil Editing Options
-----------------------
Whether the airfoil is generated within QBlade or imported, it may be necessary to edit the airfoil coordinates. This can be achieved in QBlade by using the editing options. 
These can be called either by right-clicking on the airfoil in the foil list or by selecting the corresponding option from the *Airfoil* menu. The editing options are as follows:

* **Normalize Airfoil:** The coordinates are scaled proportionally such that the leading edge has position :math:`x=0.0` and the trailing edge has position :math:`x=1.0`.
* **Duplicate Airfoil:** The panel coordinates are duplicated and an additional airfoil object is created with these coordinates.
* **De-rotate Airfoil:** The mean camber line of the airfoil is calculated and the coordinates are rotated such that the leading edge and trailing edge are both on the :math:`x`-axis.
* **Re-panel Airfoil:** The current airfoil coordinates are used to generate a second set of coordinates where the :math:`x`-coordinates have a cosine distribution (increased refinement near leading and trailing edge regions) and the new positions are interpolated from the original coordinates. 
* **Edit Current Airfoil Coordinates:** The list of airfoil coordinates is displayed and the user can delete, add or modify coordinates.

Airfoil Transformations
-----------------------
In addition to airfoil editing options, there exist a range of options to transform the current airfoil for more detailed analyses. These include:

* **Set T.E. Flap:** This introduces a trailing edge deflection to the airfoil. This requires specification of the flap angle and the hinge :math:`x` and :math:`y` positions (specified as fraction of chord length and airfoil thickness, respectively).
* **Set T.E. Gap:** This introduces a blunt trailing edge. This requires specification of the gap height (specified as fraction of chord length) and the blending distance. The blending distance specifies the position along the profile where the tangent curve begins (terminating at the modified TE nodes). 
* **Interpolate Airfoils:** This allows the generation of intermediate profiles for blended blade sections. 
* **Virtual Camber:** The virtual camber feature modifies the airfoil profile to account for the curved path traversed by the blade of a vertical axis wind turbine. This requires specification of the tip speed ratio of the turbine and the chord to radius ratio.

To illustrate two of these features, the NACA 4412 profile generated above has been modified to account for a trailing edge gap and a trailing edge flap. The modified profiles are shown in :numref:`fig-nacagapflap-airfoil`.

.. _fig-nacagapflap-airfoil:
.. figure:: naca_gapflap.png
    :align: center
    :alt: NACA Airfoil with gap and flap.

    The NACA4412 airfoil generated previously is transformed to have a trailing edge gap (dashed line) and a trailing edge flap (dash-dot line).

Exporting Airfoils
------------------
All airfoils generated within the airfoil creation module can be exported as a ``.afl`` file simply by selecting the *Export Current Airfoil* option from the *Airfoil* menu.
An exemplary ``.afl`` file is shown below:

.. code-block:: console

	NACA 2020
	 1.00000     0.00210
	 0.99346     0.00388
	 0.98296     0.00672
	 0.97159     0.00975
	 0.95935     0.01297
	 0.94627     0.01635
	 0.93239     0.01989
	 0.91780     0.02355
	 0.90259     0.02730
	 0.88685     0.03111
	 0.87069     0.03495
	 0.85419     0.03879
	 0.83743     0.04263
	 0.82048     0.04643
	 0.80337     0.05019
	 0.78615     0.05389
	 0.76885     0.05754
	 0.75150     0.06112
	 0.73412     0.06462
	 0.71671     0.06805
	 0.69930     0.07140
	 0.68189     0.07466
	 0.66450     0.07784
	 0.64713     0.08093
	 0.62979     0.08392
	 0.61250     0.08682
	 0.59525     0.08962
	 0.57805     0.09231
	 0.56093     0.09489
	 0.54387     0.09737
	 0.52689     0.09972
	 0.51000     0.10196
	 0.49320     0.10408
	 0.47651     0.10606
	 0.45993     0.10791
	 0.44347     0.10963
	 0.42715     0.11120
	 0.41097     0.11263
	 0.39495     0.11390
	 0.37910     0.11503
	 0.36343     0.11599
	 0.34796     0.11679
	 0.33271     0.11743
	 0.31769     0.11789
	 0.30293     0.11819
	 0.28844     0.11832
	 0.27425     0.11827
	 0.26039     0.11805
	 0.24688     0.11767
	 0.23374     0.11712
	 0.22101     0.11641
	 0.20869     0.11554
	 0.19683     0.11454
	 0.18542     0.11340
	 0.17450     0.11214
	 0.16406     0.11077
	 0.15411     0.10929
	 0.14466     0.10774
	 0.13568     0.10610
	 0.12718     0.10440
	 0.11914     0.10265
	 0.11154     0.10086
	 0.10436     0.09903
	 0.09759     0.09717
	 0.09119     0.09529
	 0.08515     0.09338
	 0.07945     0.09147
	 0.07407     0.08954
	 0.06898     0.08761
	 0.06417     0.08567
	 0.05962     0.08372
	 0.05532     0.08177
	 0.05125     0.07982
	 0.04739     0.07786
	 0.04373     0.07589
	 0.04027     0.07392
	 0.03699     0.07195
	 0.03388     0.06996
	 0.03094     0.06797
	 0.02815     0.06598
	 0.02551     0.06397
	 0.02302     0.06195
	 0.02067     0.05993
	 0.01846     0.05789
	 0.01638     0.05584
	 0.01443     0.05377
	 0.01261     0.05169
	 0.01092     0.04960
	 0.00935     0.04750
	 0.00791     0.04538
	 0.00659     0.04326
	 0.00540     0.04112
	 0.00433     0.03898
	 0.00338     0.03684
	 0.00256     0.03469
	 0.00185     0.03254
	 0.00127     0.03041
	 0.00080     0.02828
	 0.00044     0.02616
	 0.00019     0.02407
	 0.00005     0.02200
	 0.00000     0.01994
	 0.00005     0.01786
	 0.00021     0.01576
	 0.00047     0.01364
	 0.00084     0.01150
	 0.00133     0.00934
	 0.00194     0.00718
	 0.00267     0.00501
	 0.00352     0.00283
	 0.00450     0.00067
	 0.00560    -0.00150
	 0.00683    -0.00365
	 0.00818    -0.00580
	 0.00966    -0.00794
	 0.01127    -0.01006
	 0.01301    -0.01217
	 0.01488    -0.01427
	 0.01688    -0.01635
	 0.01901    -0.01842
	 0.02128    -0.02048
	 0.02369    -0.02253
	 0.02624    -0.02457
	 0.02895    -0.02660
	 0.03181    -0.02862
	 0.03483    -0.03063
	 0.03802    -0.03264
	 0.04139    -0.03464
	 0.04495    -0.03664
	 0.04871    -0.03864
	 0.05268    -0.04063
	 0.05688    -0.04262
	 0.06132    -0.04461
	 0.06601    -0.04660
	 0.07098    -0.04858
	 0.07624    -0.05057
	 0.08181    -0.05255
	 0.08772    -0.05452
	 0.09398    -0.05648
	 0.10063    -0.05842
	 0.10768    -0.06035
	 0.11515    -0.06226
	 0.12307    -0.06413
	 0.13146    -0.06597
	 0.14033    -0.06776
	 0.14971    -0.06949
	 0.15959    -0.07114
	 0.16999    -0.07272
	 0.18090    -0.07421
	 0.19232    -0.07559
	 0.20423    -0.07686
	 0.21662    -0.07800
	 0.22947    -0.07900
	 0.24275    -0.07987
	 0.25643    -0.08059
	 0.27050    -0.08115
	 0.28492    -0.08157
	 0.29967    -0.08182
	 0.31472    -0.08193
	 0.33005    -0.08188
	 0.34564    -0.08168
	 0.36146    -0.08133
	 0.37750    -0.08083
	 0.39375    -0.08020
	 0.41018    -0.07942
	 0.42679    -0.07852
	 0.44355    -0.07749
	 0.46046    -0.07634
	 0.47752    -0.07507
	 0.49469    -0.07368
	 0.51199    -0.07219
	 0.52939    -0.07060
	 0.54689    -0.06890
	 0.56448    -0.06711
	 0.58215    -0.06523
	 0.59989    -0.06327
	 0.61770    -0.06122
	 0.63557    -0.05909
	 0.65348    -0.05689
	 0.67142    -0.05462
	 0.68940    -0.05228
	 0.70739    -0.04987
	 0.72539    -0.04740
	 0.74338    -0.04487
	 0.76134    -0.04228
	 0.77925    -0.03965
	 0.79709    -0.03696
	 0.81482    -0.03424
	 0.83239    -0.03148
	 0.84977    -0.02870
	 0.86687    -0.02590
	 0.88361    -0.02311
	 0.89990    -0.02034
	 0.91564    -0.01762
	 0.93070    -0.01497
	 0.94500    -0.01240
	 0.95845    -0.00995
	 0.97100    -0.00762
	 0.98262    -0.00543
	 0.99334    -0.00339
	 1.00000    -0.00210

.. footbibliography::